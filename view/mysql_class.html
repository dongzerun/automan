{% extends nav.monitor.html %}
{% block monitor %}
<div class="col-sm-9  main">
    <h3 class="page-header">MySQL产品线配置</h3>
    <div class="row placeholders">
<!-- Button trigger modal -->
<button class="btn btn-primary" data-toggle="modal" data-target="#modalconfadd">
  添加新产品线
</button>


                <!-- Modal -->
                <div class="modal fade" id="modalconfadd" tabindex="-1" role="dialog" aria-labelledby="modalconfadd_label" aria-hidden="true">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="modalconfadd_label">添加产品线</h4>
                        <label class="control-label" id="modalconfadd_id"></label>
                      </div>
                      <div class="modal-body">
                        <form class="form-horizontal" role="form">
                          <div class="form-group">
                            <label for="classname" class="col-sm-offset-1 col-sm-2 control-label btn-primary">产品线</label>
                            <div class="col-sm-6">
                              <input type="text" class="form-control" id="classname" value="" placeholder="">
                            </div>
                          </div>
                          <div class="form-group">
                            <label for="namecn" class="col-sm-offset-1 col-sm-2 control-label btn-primary">中文名</label>
                            <div class="col-sm-6">
                              <input type="text" class="form-control" id="namecn" value="" placeholder="">
                            </div>
                          </div>
                          <div class="form-group">
                            <label for="port" class="col-sm-offset-1 col-sm-2 control-label btn-primary">端口</label>
                            <div class="col-sm-6">
                              <input type="text" class="form-control" id="port" value="3306" placeholder="3306">
                            </div>
                          </div>
                          <div class="form-group">
                            <label for="hasreal" class="col-sm-offset-1 col-sm-2 control-label btn-primary">REAL</label>
                            <div class="col-sm-6">
                              <input type="text" class="form-control" id="hasreal" value="0" placeholder="0">
                            </div>
                          </div>
                          <div class="form-group">
                            <label for="hasqa" class="col-sm-offset-1 col-sm-2 control-label btn-primary">QA</label>
                            <div class="col-sm-6">
                              <input type="text" class="form-control" id="hasqa" value="0" placeholder="0">
                            </div>
                          </div>
                          <div class="form-group">
                            <label for="hasim" class="col-sm-offset-1 col-sm-2 control-label btn-primary">SIM</label>
                            <div class="col-sm-6">
                              <input type="text" class="form-control" id="hassim" value="0" placeholder="0">
                            </div>
                          </div>
                          <div class="form-group">
                            <label for="hasbak" class="col-sm-offset-1 col-sm-2 control-label btn-primary">备份</label>
                            <div class="col-sm-6">
                              <input type="text" class="form-control" id="hasbak" value="0" placeholder="0">
                            </div>
                          </div>
                          <div class="form-group">
                            <label for="bakhost" class="col-sm-offset-1 col-sm-2 control-label btn-primary">备份主机</label>
                            <div class="col-sm-6">
                              <input type="text" class="form-control" id="bakhost" value="" placeholder="">
                            </div>
                          </div>
                          <div class="form-group">
                            <label for="bakdir" class="col-sm-offset-1 col-sm-2 control-label btn-primary">备份目录</label>
                            <div class="col-sm-6">
                              <input type="text" class="form-control" id="bakdir" value="" placeholder="">
                            </div>
                          </div>
                          <div class="form-group">
                            <label for="bakdays" class="col-sm-offset-1 col-sm-2 control-label btn-primary">备份天数</label>
                            <div class="col-sm-6">
                              <input type="text" class="form-control" id="bakdays" value="1" placeholder="1">
                            </div>
                          </div>
                        </form>
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                        <button type="button" class="btn btn-primary" id="modalconfadd_sub" data-dismiss="modal">提交</button>
                      </div>
                    </div>
                  </div>
                </div>

     <h2 class="sub-header"> </h2>
     <div class="panel panel-default">
     <div class="table-responsive">
         <table class="table table-striped table-bordered table-hover">
             <thead>
             <tr class="info">
             <th >产品线</th>
             <th >中文名</th>
             <th >端口</th>
             <th >real</th>
             <th >qa</th>
             <th >sim</th>
             <th >bak</th>
             <th >备份主机</th>
             <th >备份目录</th>
             <th >保留天数</th>
             <th >编辑</th>
             </tr>
             </thead>
             <tbody>
                {% for classin in classes %}
                         <td id="{{classin['id']}}_classname" value="{{classin['class']}}">{{classin['class']}}</td>
                         <td id="{{classin['id']}}_classcn" value="{{classin['class_zh']}}">{{classin['class_zh']}}</td>
                         <td id="{{classin['id']}}_port" value="{{classin['port']}}">{{classin['port']}}</td>
                         <td id="{{classin['id']}}_has_real" value="{{classin['has_real']}}">{{classin['has_real']}}</td>
                         <td id="{{classin['id']}}_has_qa" value="{{classin['has_qa']}}">{{classin['has_qa']}}</td>
                         <td id="{{classin['id']}}_has_sim" value="{{classin['has_sim']}}">{{classin['has_sim']}}</td>
                         <td id="{{classin['id']}}_has_bak" value="{{classin['has_bak']}}">{{classin['has_bak']}}</td>
                         <td id="{{classin['id']}}_has_host" value="{{classin['bak_host']}}">{{classin['bak_host']}}</td>
                         <td id="{{classin['id']}}_has_dir" value="{{classin['bakdir']}}">{{classin['bakdir']}}</td>
                         <td id="{{classin['id']}}_has_days" value="{{classin['retain_days']}}">{{classin['retain_days']}}</td>
                <td>                    
                <!-- Button trigger modal -->
                <button class="btn btn-primary" id="{{classin['id']}}_edit_btn" data-toggle="modal" data-target="#modal_monconf">
                  编辑
                </button>
                </td>  


                        </tr>
                 {% end %}
             </tbody>
        </table>
    </div>
    </div>



        <script type="text/javascript">
            $('#modal_mon_edit').on('hidden.bs.modal', function (e) {
                window.location.reload()
            });


        $('#modal_mon_edit').on('show.bs.modal', function (e) {
            modal_edit_saves = new Array;
            modal_edit_saves = e.relatedTarget.id.split("_");
            var id=modal_edit_saves[0];
            var hostname=document.getElementById(id + "_host_tr").childNodes[0].nodeValue;
            $("#editclasshost").attr("value", hostname)
            $("#editclasshost").html(hostname)

            var hostport=document.getElementById(id + "_port_tr").childNodes[0].nodeValue;
            $("#editclassport").attr("value", hostport)
            $("#editclassport").html(hostport)

            var hostclass=document.getElementById(id + "_class_tr").childNodes[0].nodeValue;
            var editclassname=document.getElementById("editclassname")
            for(i=0;i<editclassname.length;i++){
               if(hostclass == editclassname.options[i].value){
                    editclassname.options[i].selected=true
                }
            }

            var hostrole=document.getElementById(id + "_ismaster_tr").childNodes[0].nodeValue;
            var hostrole_value;
            if(hostrole == "slave"){
                hostrole_value=0
            } else if (hostrole == "master") {
                hostrole_value=1
            } else {
                hostrole_value=2
            }
            var editclassrole=document.getElementById("editclassrole")
            for(i=0;i<editclassrole.length;i++){
                if(hostrole_value == editclassrole.options[i].value){
                    editclassrole.options[i].selected=true
                }
            }

            var hostdaylag=document.getElementById(id + "_daylag_tr").childNodes[0].nodeValue;
            $("#editclassdaylag").attr("value", hostdaylag)
            $("#editclassdaylag").html(hostdaylag)

            var hostnightlag=document.getElementById(id + "_nightlag_tr").childNodes[0].nodeValue;
            $("#editclassnightlag").attr("value", hostnightlag)
            $("#editclassnightlag").html(hostnightlag)

            
            var hostcom=document.getElementById(id + "_com_tr").childNodes[0].nodeValue;
            $("#editclasscom").attr("value", hostcom)
            $("#editclasscom").html(hostcom)

            $("#modal_mon_edit_label").html(hostname+":"+hostport+" "+hostclass)
            $("#modal_mon_edit_monid").attr("value", id)
        })
        </script>

    <script type="text/javascript">
        $(function () {
            $("#comm_edit_save").bind("click", function () {
                var editclassname=$("#editclassname").val();
                var editclassrole=$("#editclassrole").val();
                var editclasshost=$("#editclasshost").val();
                var editclassport=$("#editclassport").val();
                var editclassnightlag=$("#editclassnightlag").val();
                var pkid=$("#modal_mon_edit_monid").attr("value");
                var editclassdaylag=$("#editclassdaylag").val();
                var editclasscom=$("#editclasscom").val();
                $.post("/monitor/mysql/edit_mon_save",{editclassname:editclassname,editclassrole:editclassrole,editclasshost:editclasshost,editclassport:editclassport,editclassnightlag:editclassnightlag,editclassdaylag:editclassdaylag,editclasscom:editclasscom,pk:pkid} ,function(data){});
            })
        });
    </script>

    <script type="text/javascript">
        $(function () {
            $("#comm_edit_del").bind("click", function () {
                var pkid=$("#modal_mon_edit_monid").attr("value");
                $.post("/monitor/mysql/del_mon_save",{pk:pkid} ,function(data){});
            })
        });
    </script>



                <!-- Modal -->
                <div class="modal fade" id="modal_monconf" tabindex="-1" role="dialog" aria-labelledby="modal_monconf_label" aria-hidden="true">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="modal_monconf_label"></h4>
                        <label class="control-label" id="modal_monconf_id"></label>
                      </div>
                      <div class="modal-body">
                        <form class="form-horizontal" role="form">
                          <div class="form-group">
                            <label for="editclassname" class="col-sm-offset-1 col-sm-2 control-label btn-primary">产品线</label>
                            <div class="col-sm-6">
                              <input type="text" class="form-control" id="editclassname" value="" placeholder="">
                            </div>
                          </div>
                          <div class="form-group">
                            <label for="editclasscn" class="col-sm-offset-1 col-sm-2 control-label btn-primary">中文名</label>
                            <div class="col-sm-6">
                              <input type="text" class="form-control" id="editnamecn" value="" placeholder="">
                            </div>
                          </div>
                          <div class="form-group">
                            <label for="editport" class="col-sm-offset-1 col-sm-2 control-label btn-primary">端口</label>
                            <div class="col-sm-6">
                              <input type="text" class="form-control" id="editport" value="" placeholder="">
                            </div>
                          </div>
                          <div class="form-group">
                            <label for="edithasreal" class="col-sm-offset-1 col-sm-2 control-label btn-primary">REAL</label>
                            <div class="col-sm-6">
                              <input type="text" class="form-control" id="edithasreal" value="" placeholder="">
                            </div>
                          </div>
                          <div class="form-group">
                            <label for="edithasqa" class="col-sm-offset-1 col-sm-2 control-label btn-primary">QA</label>
                            <div class="col-sm-6">
                              <input type="text" class="form-control" id="edithasqa" value="" placeholder="">
                            </div>
                          </div>
                          <div class="form-group">
                            <label for="edithassim" class="col-sm-offset-1 col-sm-2 control-label btn-primary">SIM</label>
                            <div class="col-sm-6">
                              <input type="text" class="form-control" id="edithassim" value="" placeholder="">
                            </div>
                          </div>
                          <div class="form-group">
                            <label for="edithasbak" class="col-sm-offset-1 col-sm-2 control-label btn-primary">是否备份</label>
                            <div class="col-sm-6">
                              <input type="text" class="form-control" id="edithasbak" value="" placeholder="">
                            </div>
                          </div>
                          <div class="form-group">
                            <label for="editbakhost" class="col-sm-offset-1 col-sm-2 control-label btn-primary">备份主机</label>
                            <div class="col-sm-6">
                              <input type="text" class="form-control" id="editbakhost" value="" placeholder="">
                            </div>
                          </div>
                          <div class="form-group">
                            <label for="editbakdir" class="col-sm-offset-1 col-sm-2 control-label btn-primary">备份目录</label>
                            <div class="col-sm-6">
                              <input type="text" class="form-control" id="editbakdir" value="" placeholder="">
                            </div>
                          </div>

                          <div class="form-group">
                            <label for="editbakdays" class="col-sm-offset-1 col-sm-2 control-label btn-primary">保留天数</label>
                            <div class="col-sm-6">
                              <input type="text" class="form-control" id="editbakdays" value="" placeholder="">
                            </div>
                          </div>
                        </form>
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                        <button type="button" class="btn btn-danger pull-left" id="monconf_del" data-dismiss="modal">删除</button>
                        <button type="button" class="btn btn-primary" id="monconf_sub" data-dismiss="modal">提交</button>
                      </div>
                    </div>
                  </div>
                </div>
<script type="text/javascript">
$('#modal_monconf').on('show.bs.modal', function (e) {
    modal_monconf = new Array;
    modal_monconf = e.relatedTarget.id.split("_");
    var id=modal_monconf[0];
    var classname=document.getElementById(id + "_classname").innerHTML;
    var namecn=document.getElementById(id + "_classcn").innerHTML;
    var port=document.getElementById(id + "_port").innerHTML;
    var hasreal=document.getElementById(id + "_has_real").innerHTML;
    var hasqa=document.getElementById(id + "_has_qa").innerHTML;
    var hassim=document.getElementById(id + "_has_sim").innerHTML;
    var hasbak=document.getElementById(id + "_has_bak").innerHTML;
    var hashost=document.getElementById(id + "_has_host").innerHTML;
    var hasdir=document.getElementById(id + "_has_dir").innerHTML;
    var hasdays=document.getElementById(id + "_has_days").innerHTML;
 
 
 
    $("#modal_monconf_label").val(classname);
    $("#editclassname").val(classname);
    $("#editnamecn").val(namecn);
    $("#editport").val(port);
    $("#edithasreal").val(hasreal);
    $("#edithasqa").val(hasqa);
    $("#edithassim").val(hassim);
    $("#edithasbak").val(hasbak);
    $("#editbakhost").val(hashost);
    $("#editbakdir").val(hasdir);
    $("#editbakdays").val(hasdays);
 $("#monconf_del").bind("click", function () {
                var classname=$("#editclassname").val();
                $.post("/monitor/mysql/savedelclass",{classname:classname} ,function(data){});
            });

            $('#modal_monconf').on('hidden.bs.modal', function (e) {
                window.location.reload()
            });
 $("#monconf_sub").bind("click", function () {
    var classname = $("#editclassname").val();
    var namecn = $("#editnamecn").val();
    var port = $("#editport").val();
    var hasreal = $("#edithasreal").val();
    var hasqa = $("#edithasqa").val();
    var hassim =  $("#edithassim").val();
    var hasbak = $("#edithasbak").val();
    var bakhost = $("#editbakhost").val();
    var bakdir = $("#editbakdir").val();
    var bakdays = $("#editbakdays").val();
                $.post("/monitor/mysql/savesubclass",{classname:classname,namecn:namecn, port:port,hasreal:hasreal,hasqa:hasqa,hassim:hassim,hasbak:hasbak,bakhost:bakhost,bakdir:bakdir,bakdays:bakdays} ,function(data){});
            });
});

 $("#modalconfadd_sub").bind("click", function () {
                var classname=$("#classname").val();
                var namecn=$("#namecn").val();
                var port=$("#port").val();
                var hasreal=$("#hasreal").val();
                var hasqa=$("#hasqa").val();
                var hassim=$("#hassim").val();
                var hasbak=$("#hasbak").val();
                var bakhost=$("#bakhost").val();
                var bakdir=$("#bakdir").val();
                var bakdays=$("#bakdays").val();
                if(classname == '') {
                    alert("classname must not null");
                    return;
                }
                $.post("/monitor/mysql/savenewclass",{classname:classname,namecn:namecn,port:port,hasreal:hasreal,hasqa:hasqa,hassim:hassim,hasbak:hasbak,bakhost:bakhost,bakdir:bakdir,bakdays:bakdays} ,function(data){});
            });
            $('#modalconfadd').on('hidden.bs.modal', function (e) {
                window.location.reload()
            });
</script>


</div>
{% end %}
